# 電子メール送受信の基本的知識

# メールサーバーの役割

メールサーバーは、いわば電子メールの郵便局のような役割を果たします。ユーザーがメールを送信すると、そのメールはまず送信者のメールサーバーに送られ、次に受信者のメールサーバーに転送されます。受信者は自分のメールサーバーにアクセスして、送られてきたメールを読むことができます。

---

## **📡 メールサーバーの種類**

### **1️⃣ SMTPサーバー（送信）**

- **役割:** メールの送信と転送を担当
- **プロトコル:** SMTP (Simple Mail Transfer Protocol)
- **ポート番号:** 25, 465, 587
- **説明:** SMTPサーバーは、ユーザーがメールを送信する際に使用され、異なるメールサーバー間でメールを転送する役割も担います。

### **2️⃣ IMAP/POPサーバー（受信）**

- **役割:** メールの受信と管理を担当
- **プロトコル:** IMAP (Internet Message Access Protocol) および POP3 (Post Office Protocol)
- **ポート番号:** 143 (IMAP), 993 (IMAPS), 110 (POP3), 995 (POP3S)
- **説明:**
    - **IMAP:** メールをサーバー上で管理し、複数のデバイスからアクセス可能にする。
    - **POP3:** メールをクライアントにダウンロードし、基本的にはサーバーから削除する。

---

## **📡 メールの送受信に必要なポートの詳細**

### **1️⃣ 送信メール用（SMTP）**

### **📌 25番ポート（SMTP - メールサーバー間通信）**

- **用途:** メールサーバー同士のメール転送
- **暗号化:** なし（TLS/SSLなし）
- **説明:**
    - メールサーバー間でメールを転送するために使用。
    - クライアント（Thunderbird, Outlookなど）からの送信には**使用しない**。
    - クライアント送信には `587番ポート` を使用するのが推奨。

```
sudo ufw allow 25/tcp  # メールサーバー間通信用
```

### **📌 587番ポート（SMTP - クライアント送信）**

- **用途:** クライアント（メールソフト）からのメール送信
- **暗号化:** STARTTLS（推奨）
- **説明:**
    - メールクライアントがメールを送信する際に使用。
    - STARTTLSを利用して安全な送信が可能。
    - ISPが `25番ポート` をブロックする場合が多いため、クライアントはこのポートを使用。

```
sudo ufw allow 587/tcp  # クライアント送信用
```

---

### **2️⃣ 受信メール用（IMAP/POP3）**

### **📌 143番ポート（IMAP - 非暗号化）**

- **用途:** サーバー上のメールにアクセス
- **暗号化:** なし（推奨されない）
- **説明:**
    - メールをサーバー上で管理し、複数のデバイスからアクセス可能。
    - 143番ポートは**暗号化なし**のIMAP通信。
    - セキュリティ上の理由で `993番ポート（IMAPS）` の使用が推奨。

```
sudo ufw allow 143/tcp  # IMAP（暗号化なし）
```

### **📌 993番ポート（IMAPS - 暗号化IMAP）**

- **用途:** 暗号化されたIMAP通信
- **暗号化:** SSL/TLS
- **説明:**
    - メールクライアントが**暗号化されたIMAP通信**を行う際に使用。
    - GmailやYahooメールなどのサービスもIMAPS（993番）を使用。

```
sudo ufw allow 993/tcp  # 暗号化IMAP
```

### **📌 110番ポート（POP3 - 非暗号化）**

- **用途:** メールの受信（ダウンロード＆削除）
- **暗号化:** なし（推奨されない）
- **説明:**
    - クライアントがサーバーからメールをダウンロードし、基本的にサーバーから削除する。
    - 110番ポートは**非暗号化**のため、`995番ポート（POP3S）` の使用が推奨。

```
sudo ufw allow 110/tcp  # POP3（非暗号化）
```

### **📌 995番ポート（POP3S - 暗号化POP3）**

- **用途:** 暗号化されたPOP3通信
- **暗号化:** SSL/TLS
- **説明:**
    - 110番ポートのPOP3を暗号化した安全な通信方式。
    - クライアントがメールをダウンロードして管理する場合に使用。

```
sudo ufw allow 995/tcp  # 暗号化POP3
```

---

## **📜 推奨設定コマンド**

```
sudo ufw allow 25/tcp  # メールサーバー間通信
sudo ufw allow 587/tcp # クライアント送信用
sudo ufw allow 993/tcp # 暗号化IMAP（推奨）
sudo ufw allow 995/tcp # 暗号化POP3（推奨）

# IMAP/POP3の非暗号化通信を許可する場合（非推奨）
sudo ufw allow 143/tcp # IMAP（非暗号化）
sudo ufw allow 110/tcp # POP3（非暗号化）

# 設定を有効化
sudo ufw enable
```

---

### **✅ 追加ポイント**

- クライアントのメール送信には **587番ポート（SMTP Submission）を使用するのが推奨**。
- メール受信には、**993番ポート（IMAPS）または995番ポート（POP3S）を推奨**。
- **25番ポートはサーバー間の転送専用** で、クライアントは使用しない。